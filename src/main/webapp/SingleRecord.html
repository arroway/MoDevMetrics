<HTML>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HEAD>
</HEAD>
<BODY>
<script type="text/javascript" src="js/rest/RestConfig.js"></script>
<script type="text/javascript" src="lib/js/jquery-1.7.js"></script>

<script type="text/javascript" src="js/charts/HelperFunctions.js"></script>

<script type="text/javascript" src="js/Debug.js"></script>
<script type="text/javascript" src="js/util.js"></script>
<script type="text/javascript" src="js/CNV.js"></script>
<script type="text/javascript" src="js/aDate.js"></script>
<script type="text/javascript" src="js/MVEL.js"></script>
<script type="text/javascript" src="js/SQL.js"></script>
<script type="text/javascript" src="../../test/js/SQL.js"></script>


<div id="info"></div>

<script type="text/javascript">
	console.info(new Date(1347753600000).format("yyyy-NNN-dd HHmmss"));
	console.info(new Date(1348358400000).format("yyyy-NNN-dd HHmmss"));

	var esQuery=

	{"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
		{"range":{"created_ts":{"gt":Date.now().add("-6month")}}},
//		{"not":{"range":{"expires_on":{"gt":"2012-10-17T04:01:01.000Z"}}}},
		{"or":[
			{"term":{"status_whiteboard.tokenized":"sg:dos"}},
			{"term":{"status_whiteboard.tokenized":"sg:low"}},
			{"term":{"status_whiteboard.tokenized":"sg:mod"}},
			{"term":{"status_whiteboard.tokenized":"sg:crit"}}
		]},
//		{"script":{"script":"true"}},
//		{"script":{"script":"true"}},
//		{"range":{"modified_ts":{"gte":1347753600000}}},
//		{"range":{"modified_ts":{"lt":1348358400000}}}
	]}}},"from":0,"size":100,"sort":[]

	//		"facets" : {
//			"range1" : {
//				"range" : {
//					"key_field" : "resolution",
//					"value_script" :'doc["modified_ts"].value-doc["created_ts"].value',
////					"value_script" :'doc["modified_ts"].value-doc["created_ts"].value',
////					"value_script" :'_source.modified_ts- _source.created_ts',
////					"value_script" :'(_source.modified_ts.value) - (_source.created_ts.value)',
//					"ranges" : [
//						{ "from" : 0, "to" : 86400000 },
//						{ "from" : 86400000, "to" : 172800000 },
//						{ "from" : 172800000, "to" : 259200000},
//						{ "from" : 259200000, "to" : 345600000},
//						{ "from" : 345600000, "to" : 432000000},
//						{ "from" : 432000000, "to" : 518400000},
//						{ "from" : 518400000, "to" : 604800000},
//						{ "from" : 604800000, "to" : 691200000},
//						{ "from" : 691200000, "to" : 777600000},
//						{ "from" : 777600000, "to" : 864000000},
//						{ "from" : 864000000, "to" : 950400000},
//						{ "from" : 950400000, "to" : 1036800000},
//						{ "from" : 1036800000, "to" : 1123200000},
//						{ "from" : 1123200000, "to" : 1209600000},
//						{ "from" : 1209600000, "to" : 1296000000},
//						{ "from" : 1296000000, "to" : 1382400000},
//						{ "from" : 1382400000, "to" : 1468800000},
//						{ "from" : 1468800000, "to" : 1555200000},
//						{ "from" : 1555200000, "to" : 1641600000},
//						{ "from" : 1641600000, "to" : 1728000000},
//						{ "from" : 1728000000, "to" : 1814400000},
//						{ "from" : 1814400000, "to" : 1900800000}
//					]
//				}
//			}
//		}


	};
	//                "Bug Age2": {
	//                    "range": {
	//                        "key_script": "(new java.util.Date().getTime() - doc['created_ts'].value) / 86400000",
	//                        "value_script": "1",
	//                        "ranges": [
	//                            { "from": 0, "lt": 1 },
	//                            { "from": 1, "lt": 2 },
	//                            { "from": 2, "lt": 3 },
	//                            { "from": 3, "lt": 4 },
	//                            { "from": 4, "lt": 8 },
	//                            { "from": 8, "lt": 15 },
	//                            { "from": 15, "lt": 31 },
	//                            { "from": 31, "lt": 61 },
	//                            { "from": 61, "lt": 181 },
	//                            { "from": 181, "lt": 366 },
	//                            { "from": 366, "lt": 731 },
	//                            { "from": 731 }
	//                        ],
	//                        "size": 100000
	//                    }
	//                }


	var request = $.ajax({
		url: window.ElasticSearchRestURL,
		type: "POST",
		data: JSON.stringify(esQuery),
		dataType: "json",

		success: function(data){
			console.info(CNV.Object2JSON(data));

			var htmlSummary = CNV.ESResult2HTMLSummaries(data);
			var htmlResults = CNV.List2HTMLTable(CNV.ESResult2List(data));

			document.getElementById("info").innerHTML = htmlSummary + "<br><br>" + htmlResults;
		},

		error: function (errorData, errorMsg, errorThrown){
			document.getElementById("info").innerHTML = "Response Error.  Make sure you are connected to the MPT network.";
		}
	});

</script>

</BODY>
</HTML>