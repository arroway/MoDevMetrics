<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<HTML>
<HEAD>
</HEAD>
<BODY>



<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/Base.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/jquery.js"></script>
<script type="application/javascript;version=1.7" src="../lib/jstree/jquery.jstree.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/jquery.tooltip.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/data/q01-01.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/protovis-d3.3.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/jquery.tipsy.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/tipsy.js"></script>
<link type="text/css" href="../lib/webdetails/lib/tipsy.css" rel="stylesheet"/>

<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvc.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcPanel.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcLegend.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcTimeseriesAbstract.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcCategoricalAbstract.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcWaterfall.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcPie.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcBar.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcLine.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcData.js"></script>

<link type="text/css" rel="stylesheet" href="../lib/webdetails/cdf/jquery.tooltip.css"/>
<link type="text/css" rel="stylesheet" href="../lib/webdetails/pvcComponent.css"/>

<script type="application/javascript;version=1.7" src="../lib/webdetails/pvcDocUtils.js"></script>








<link type="text/css" href="../css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="../lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="../lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="../css/menu.css"/>



<script type="application/javascript;version=1.7" src="../js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="../js/util.js"></script><script type="application/javascript;version=1.7" src="../js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="../js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="../js/Bugzilla.js"></script>

<script type="application/javascript;version=1.7" src="../js/Stats.js"></script>
<script type="application/javascript;version=1.7" src="../js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="../js/MVEL.js"></script>
<script type="application/javascript;version=1.7" src="../js/aCompiler.js"></script>

<script type="application/javascript;version=1.7" src="../js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="../js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/aChart.js"></script>






<script type="application/javascript;version=1.7" src="../js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/ElasticSearch.js"></script>

<script type="application/javascript;version=1.7" src="../js/charts/DataSet.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/RangeCharts.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/RangeIterator.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/DateRangeIterator.js"></script>

<script type="application/javascript;version=1.7" src="../js/filters/Filter.js"></script>
<script type="application/javascript;version=1.7" src="../js/filters/ComponentFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/filters/TeamFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/filters/ProductFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/filters/ClassificationFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/filters/ProgramFilter.js"></script>

<script type="application/javascript;version=1.7" src="../js/filters/GUI.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/BugTags.js"></script>



<h3>ES Fields and Their Domains</h3>

<div style="float:right;display: inline;">
	<a href="http://people.mozilla.com/~klahnakoski/" class="button">HOME</a>
</div>
<div id="chart" style="position:relative;"></div>

<div id="info"></div>
<div id="results"></div>
<table id="theTable"><thead><tr><td>Field Name</td><td>Value(s)</td></tr></thead><tbody></tbody></table>

<script type="application/javascript;version=1.7">

var createChart=function(){
	aThread.run(function(){

		yield (ESQuery.loadColumns({"from":"bugs"}));

		D.addLog("results");

//EXTRACT ALL DOMAIN VALUES TO CHARACTERIZE THE ES STORE

//ALL IMMEDIATE FIELDS
		var indexes=["bugs", "bugs.flags", "bugs.attachments", "bugs.attachments.flags"];

//ALL ATTACHMENTS
//ALL FLAGS
		indexes.forall(function(index, i){
			var columns=ESQuery.INDEXES[index].columns;
			columns.forall(function(col, j){
				if (col.name.indexOf(".")>0){
					addToTable(index+".\""+col.name+"\"", "has '.' in name");
					return;
				}//endif
				
				if (j>=3) return;

				
				if (col.name=="status_whiteboard"){
					//DO NOTHING
				}else if (col.name.startsWith("keyword")){
					//DO NOTHING
				}else if (col.type=="string"){
					aThread.run(function(){
						var query={
							"from":index,
							"select":{"value":index+"."+col.name}
						};
						var result=yield (ESQuery.run(query));

						var result2=yield (CUBE.calc2List({
							"from":result,
							"edges":[
								col.name
							]
						}));

						addToTable(index+"."+col.name, JSON.stringify(result2.list.map(function(v){return v[col.name];})).left(3000));
					});
				}else if (["boolean", "integer", "date", "long"].contains(col.type)){
					aThread.run(function(){
						var query={
							"from":index,
							"select":[
								{"name":"min", "value":index+"."+col.name, "operation":"minimum"},
								{"name":"max", "value":index+"."+col.name, "operation":"maximum"}
							]
						};

						var result=yield (ESQuery.run(query));
						
						addToTable(index+"."+col.name, "{min:"+result.min+",max:"+result.max+"}");
					});
				}else{
					D.error("do not know what to do here");
				}//endif



			});

		});
//GET MIN/MAX ON LINEAR FIELDS
//GET SPECIFIC VALUES ON VALUE FIELDS

		$("#info").html(CNV.String2HTML(CNV.Object2JSON(ESQuery.INDEXES)));

	});


};

var addToTable=function(name, value){
	var tbody=$("#theTable tbody");
	tbody.append("<tr>"+CNV.tag("td", name)+CNV.tag("td", value)+"</tr>");
};//method



	$(document).ready(function(){
		createChart();
	});

</script>


</BODY>
</HTML>

