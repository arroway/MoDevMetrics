<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HTML>
<HEAD>
</HEAD>
<BODY>


<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/Base.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/jquery.js"></script>
<script type="application/javascript;version=1.7" src="../lib/jstree/jquery.jstree.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/jquery.tooltip.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/data/q01-01.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/protovis-d3.3.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/jquery.tipsy.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/tipsy.js"></script>
<link type="text/css" href="../lib/webdetails/lib/tipsy.css" rel="stylesheet"/>

<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvc.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcPanel.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcLegend.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcTimeseriesAbstract.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcCategoricalAbstract.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcWaterfall.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcPie.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcBar.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcLine.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcData.js"></script>
<link type="text/css" rel="stylesheet" href="../lib/webdetails/cdf/jquery.tooltip.css"/>
<link type="text/css" rel="stylesheet" href="../lib/webdetails/pvcComponent.css"/>

<script type="application/javascript;version=1.7" src="../lib/webdetails/pvcDocUtils.js"></script>

<link type="text/css" href="../css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="../lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="../lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="../css/menu.css"/>


<script type="application/javascript;version=1.7" src="../js/charts/Status.js"></script>


<script type="application/javascript;version=1.7" src="../js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="../js/util.js"></script>
<script type="application/javascript;version=1.7" src="../js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="../js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="../js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="../js/MVEL.js"></script>
<script type="application/javascript;version=1.7" src="../js/aCompiler.js"></script>


<script type="application/javascript;version=1.7" src="../js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="../js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/aChart.js"></script>

<script type="application/javascript;version=1.7" src="../js/filters/ProgramFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/ElasticSearch.js"></script>

<script type="application/javascript;version=1.7" src="../js/etl/ETL.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/Reviews.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/BugSummary.js"></script>

<div id="status"></div>
<div id="info"></div>
<h2>Some header</h2>
<div id="chart" style="width:800px;height:400px;"></div>
<div id="chart2" style="width:800px;height:400px;"></div>


<script type="application/javascript;version=1.7">

aThread.run(function(){

	D.println(new Date(1352207434236).format("yyyy-NNN-dd HHmmss"));

	var esQuery = {"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
		{"script":{"script":"true"}},
		{"and":[
			{"term":{"bug_id":"713926"}},
//			{"range":{"expires_on":{"gt":Date.now().getMilli()}}}
//			{"term":{"attach_id":"688344"}}
		]}
	]}}},"from":0,"size":10000,"sort":[]//"bug_version_num"]
	};




//	var esQuery = {"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
//		{"script":{"script":"true"}},
//		{"and":[
////			{"range":{"request_time":{"gte":1347926400000,"lt":1355875200000}}},
//			{"term":{"bug_id":"674239"}},
////			{"term":{"attach_id":"688344"}},
////			{"terms":{"reviewer":["jpr@mozilla.com","blassey.bugs@lassey.us","chrislord.net@gmail.com","cpeterson@mozilla.com","gbrown@mozilla.com","gpascutto@mozilla.com","snorp@snorp.net","bugmail.mozilla@staktrace.com","nchen@mozilla.com","bugzilla@sherk.me","jdaggett@mozilla.com","jst@mozilla.org","continuation@gmail.com","overholt@mozilla.com","amarchesini@mozilla.com","aranganathan@mozilla.com","bent.mozilla@gmail.com","jan.varga@gmail.com","mounir@lamouri.fr","jonas@sicking.cc","bobbyholley+bmo@gmail.com","bzbarsky@mit.edu","bolterbugz@gmail.com","surkov.alexander@gmail.com","eitan@monotonous.org","hub@mozilla.com","marco.zehe@googlemail.com","trev.saunders@gmail.com","doug.turner@gmail.com","hsivonen@iki.fi","nsm.nikhil@gmail.com","bugs@pettay.fi","wchen@mozilla.com","justin.lebar+bug@gmail.com","josh@joshmatthews.net","jschoenick@mozilla.com","khuey@kylehuey.com","mrbkap@gmail.com","peterv@propagandism.org","bugs@junglecode.net","dbaron@dbaron.org","sjohnson@mozilla.com","dholbert@mozilla.com","ebassi@mozilla.com","fantasai.bugs@inkedblade.net","jfkthame@gmail.com","jwatt@jwatt.org","seth@mozilla.com","matspal@gmail.com","msreckovic@mozilla.com","bgirard@mozilla.com","bjacob@mozilla.com","bas.schouten@live.nl","gwright@mozilla.com","joe@drew.ca","jmuizelaar@mozilla.com","nical.bugzilla@gmail.com","smontagu@smontagu.org","tnikkel@gmail.com","roc@ocallahan.org","ajones@mozilla.com","chris.double@double.co.nz","cam@mcc.id.au","cpearce@mozilla.com","eflores@mozilla.com","jib@mozilla.com","jmvalin@mozilla.com","karlt@mozbugz.karlt.net","kinetik@flim.org","ventnor.bugzilla@gmail.com","matt.woodrow@gmail.com","ncameron@mozilla.com","paul@paul.cx","giles@mozilla.com","rjesup@jesup.org","tterribe@vt.edu","negge@mozilla.com"]}},
////			{"script":{"script":"var coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\n((coalesce(zero2null(doc[\"review_time\"].value), 1355875200000)-doc[\"request_time\"].value)<0) || ((coalesce(zero2null(doc[\"review_time\"].value), 1355875200000)-doc[\"request_time\"].value)>=864000000)"}}
//		]}
//	]}}},"from":0,"size":100,"sort":[]};



	try{
		var data=yield (Rest.post({
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping?pretty=true",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping",

//			"url":"http://localhost:9200/reviews/review/_search",
//			"url":"http://localhost:9200/bug_tags/bug_tags/_search",
//			"url":"http://elasticsearch8.metrics.scl3.mozilla.com:9200/reviews/review/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_summary/bug_summary/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_tags/bug_tags/_search",
			"url":"http://elasticsearch8.metrics.scl3.mozilla.com:9200/bugs/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/org_chart/person/_search",
			"data":esQuery
		}));

		D.println(CNV.Object2JSON(data));

		var htmlSummary = CNV.ESResult2HTMLSummaries(data);
		var htmlResults = CNV.List2HTMLTable(CNV.ESResult2List(data));
		$("#info").html(htmlSummary + "<br><br>" + htmlResults);


//		while(true){
//			if (ETL.allFlags!==undefined) break;
//			yield (aThread.sleep(200));
//		}//while
//		var reviews=yield (REVIEWS.get(674239, 674240));
//		$("#info").append(CNV.List2HTMLTable(reviews));
//



	}catch(e){
		D.warning("Error sending requests", e);
		document.getElementById("info").innerHTML = "Response Error.  Make sure you are connected to the MPT network.";
	}

});

</script>

</BODY>
</HTML>