<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HTML>
<HEAD>
</HEAD>
<BODY>





<script type="application/javascript;version=1.7" src="../lib/jquery.js"></script>
<link type="text/css" href="../css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="../lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="../lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="../css/menu.css"/>


<script type="application/javascript;version=1.7" src="../js/charts/Status.js"></script>


<script type="application/javascript;version=1.7" src="../js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="../js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="../js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="../js/util.js"></script>
<script type="application/javascript;version=1.7" src="../js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="../js/MVEL.js"></script>
<script type="application/javascript;version=1.7" src="../js/aCompiler.js"></script>


<script type="application/javascript;version=1.7" src="../js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="../js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/aChart.js"></script>

<script type="application/javascript;version=1.7" src="../js/filters/ProgramFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/ElasticSearch.js"></script>

<script type="application/javascript;version=1.7" src="../js/etl/ETL.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/Reviews.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/BugSummary.js"></script>

<div id="info"></div>

<script type="application/javascript;version=1.7">

aThread.run(function(){

	D.println(new Date(1352207434236).format("yyyy-NNN-dd HHmmss"));

//	var esQuery = {"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
//		{"script":{"script":"true"}},
//		{"and":[
//			{"term":{"bug_id":"740241"}}
//		]}
//	]}}},"from":0,"size":100,"sort":["bug_version_num"]
//	};

	var esQuery = {"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
		{"script":{"script":"true"}},
		{"and":[
			{"range":{"request_time":{"gte":1347321600000,"lt":1355270400000}}},
			{"script":{"script":"true"}},
			{"script":{"script":"true"}},
			{"script":{"script":"true"}},
			{"terms":{"reviewer":["msreckovic@mozilla.com","bgirard@mozilla.com","bjacob@mozilla.com","bas.schouten@live.nl","gwright@mozilla.com","joe@drew.ca","jmuizelaar@mozilla.com","nical.bugzilla@gmail.com"]}},
			{"script":{"script":"((coalesce(zero2null(doc[\"review_time\"].value), 1355270400000)-doc[\"request_time\"].value)<0) || ((coalesce(zero2null(doc[\"review_time\"].value), 1355270400000)-doc[\"request_time\"].value)>=864000000)"}}
		]}
	]}}},"from":0,"size":0,"sort":[],"facets":{"mvel":{"terms":{"script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar Value2Pipe = function(value){\nif (value==null){ \"0\" }else if (value is ArrayList){ 's'+value.toString(); }else \nif (value is Long || value is Integer){ 'n'+value; }else \nif (!(value is String)){ 's'+value.getClass().getName(); }else \n\"s\"+value.replace(\"\\\\\", \"\\\\\\\\\").replace(\"|\", \"\\\\p\");};\nvar cool_func = function(reviews){\nvar bug_id = doc[\"bug_id\"].value;\noutput=\"\";\nif (true){output = Value2Pipe(bug_id)\n;\n}\noutput;\n};\ncool_func(_source)\n","size":100000}}}};
	try{
		var data=yield (Rest.post({
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping?pretty=true",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping",

//			"url":"http://localhost:9200/reviews/review/_search",
//			"url":"http://localhost:9200/bug_tags/bug_tags/_search",
			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/reviews/review/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_summary/bug_summary/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/org_chart/person/_search",
			"data":esQuery
		}));

		D.println(CNV.Object2JSON(data));

		var htmlSummary = CNV.ESResult2HTMLSummaries(data);
		var htmlResults = CNV.List2HTMLTable(CNV.ESResult2List(data));
		document.getElementById("info").innerHTML = htmlSummary + "<br><br>" + htmlResults;

	}catch(e){
		D.warning(errorData);
		document.getElementById("info").innerHTML = "Response Error.  Make sure you are connected to the MPT network.";
	}

});

</script>

</BODY>
</HTML>