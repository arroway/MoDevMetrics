<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HTML>
<HEAD>
</HEAD>
<BODY>





<script type="application/javascript;version=1.7" src="../lib/jquery.js"></script>
<link type="text/css" href="../css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="../lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="../lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="../css/menu.css"/>


<script type="application/javascript;version=1.7" src="../js/charts/Status.js"></script>


<script type="application/javascript;version=1.7" src="../js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="../js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="../js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="../js/util.js"></script>
<script type="application/javascript;version=1.7" src="../js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="../js/MVEL.js"></script>
<script type="application/javascript;version=1.7" src="../js/aCompiler.js"></script>


<script type="application/javascript;version=1.7" src="../js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="../js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/aChart.js"></script>

<script type="application/javascript;version=1.7" src="../js/filters/ProgramFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/ElasticSearch.js"></script>

<script type="application/javascript;version=1.7" src="../js/etl/ETL.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/Reviews.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/BugSummary.js"></script>

<div id="info"></div>

<script type="application/javascript;version=1.7">

aThread.run(function(){

	D.println(new Date(1352207434236).format("yyyy-NNN-dd HHmmss"));

//	var esQuery = {"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
//		{"script":{"script":"true"}},
//		{"and":[
//			{"term":{"bug_id":"740241"}}
//		]}
//	]}}},"from":0,"size":100,"sort":["bug_version_num"]
//	};

	var esQuery = {"query":{"filtered":{"query":{"match_all":{}},"filter":{"and":[
		{"script":{"script":"true"}},
		{"and":[
			{"script":{"script":"1344643200000 <= doc[\"create_time\"].value && doc[\"create_time\"].value < 1355529600000"}},
			{"script":{"script":"true"}},
			{"script":{"script":"true"}}
		]}
	]}}},"from":0,"size":100,"sort":[],"facets":{"0":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=0 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<604800000"}}
	]}},"1":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=604800000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<1209600000"}}
	]}},"2":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=1209600000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<1814400000"}}
	]}},"3":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=1814400000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<2419200000"}}
	]}},"4":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=2419200000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<3024000000"}}
	]}},"5":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=3024000000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<3628800000"}}
	]}},"6":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=3628800000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<4233600000"}}
	]}},"7":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=4233600000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<4838400000"}}
	]}},"8":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=4838400000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<5443200000"}}
	]}},"9":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=5443200000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<6048000000"}}
	]}},"10":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=6048000000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<6652800000"}}
	]}},"11":{"terms_stats":{"key_field":"minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000)) < 1355529600000 ? \"Closed\" : \"Open\"","value_field":"bug_id","size":200000},"facet_filter":{"and":[
		{"script":{"script":"var minimum = function(a, b){if (a==null) b; else if (b==null) a; else if (a<b) a; else b;\n};\nvar coalesce = function(a, b){if (a==null) b; else a; \n};\nvar zero2null = function(a){if (a==0) null; else a; \n};\nminimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value>=6652800000 && minimum(1355529600000, coalesce(zero2null(doc[\"close_time\"].value), 1355529600000))-doc[\"create_time\"].value<7257600000"}}
	]}}}};

	try{
		var data=yield (Rest.post({
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping?pretty=true",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping",

//			"url":"http://localhost:9200/reviews/review/_search",
//			"url":"http://localhost:9200/bug_tags/bug_tags/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/reviews/review/_search",
			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_summary/bug_summary/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_tags/bug_tags/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/org_chart/person/_search",
			"data":esQuery
		}));

		D.println(CNV.Object2JSON(data));

		var htmlSummary = CNV.ESResult2HTMLSummaries(data);
		var htmlResults = CNV.List2HTMLTable(CNV.ESResult2List(data));
		document.getElementById("info").innerHTML = htmlSummary + "<br><br>" + htmlResults;

	}catch(e){
		D.warning(errorData);
		document.getElementById("info").innerHTML = "Response Error.  Make sure you are connected to the MPT network.";
	}

});

</script>

</BODY>
</HTML>