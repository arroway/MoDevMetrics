<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<HTML>
<HEAD>
<script type="application/javascript;version=1.7" src="../js/Settings.js">
</script></HEAD>
<BODY>


<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/Base.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/jquery.js"></script>
<script type="application/javascript;version=1.7" src="../lib/jstree/jquery.jstree.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/cdf/jquery.tooltip.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/data/q01-01.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/protovis-d3.3.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/jquery.tipsy.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/lib/tipsy.js"></script>
<link type="text/css" href="../lib/webdetails/lib/tipsy.css" rel="stylesheet"/>

<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvc.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcPanel.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcLegend.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcTimeseriesAbstract.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcCategoricalAbstract.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcWaterfall.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcPie.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcBar.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcLine.js"></script>
<script type="application/javascript;version=1.7" src="../lib/webdetails/pvc/pvcData.js"></script>
<link type="text/css" rel="stylesheet" href="../lib/webdetails/cdf/jquery.tooltip.css"/>
<link type="text/css" rel="stylesheet" href="../lib/webdetails/pvcComponent.css"/>

<script type="application/javascript;version=1.7" src="../lib/webdetails/pvcDocUtils.js"></script>

<link type="text/css" href="../css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="../lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="../lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="../css/menu.css"/>


<script type="application/javascript;version=1.7" src="../js/aUtil.js"></script>
<script type="application/javascript;version=1.7" src="../js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="../js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="../js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="../js/aDebug.js"></script>
<script type="application/javascript;version=1.7" src="../js/MVEL.js"></script>
<script type="application/javascript;version=1.7" src="../js/aCompiler.js"></script>


<script type="application/javascript;version=1.7" src="../js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="../js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="../js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/aChart.js"></script>

<script type="application/javascript;version=1.7" src="../js/gui/ProgramFilter.js"></script>
<script type="application/javascript;version=1.7" src="../js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="../js/rest/ElasticSearch.js"></script>

<script type="application/javascript;version=1.7" src="../js/etl/ETL.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/Reviews.js"></script>
<script type="application/javascript;version=1.7" src="../js/etl/BugSummary.js"></script>

<div id="status"></div>
<div id="info"></div>
<h2>Simple Query</h2>

<div id="chart" style="width:800px;height:400px;"></div>
<div id="chart2" style="width:800px;height:400px;"></div>


<script type="application/javascript;version=1.7">

	aThread.run(function(){

		D.println(Date.newInstance(1352207434236).format("yyyy-NNN-dd HHmmss"));
		yield (ESQuery.loadColumns({"from":"bugs"}));

		var esQuery = { "facets":{ "59":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1363305600000"}}},
				{"range":{"expires_on":{"gte":"1363305600000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "58":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1363219200000"}}},
				{"range":{"expires_on":{"gte":"1363219200000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "57":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1363132800000"}}},
				{"range":{"expires_on":{"gte":"1363132800000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "56":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1363046400000"}}},
				{"range":{"expires_on":{"gte":"1363046400000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "55":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1362960000000"}}},
				{"range":{"expires_on":{"gte":"1362960000000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "54":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1362873600000"}}},
				{"range":{"expires_on":{"gte":"1362873600000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "53":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1362787200000"}}},
				{"range":{"expires_on":{"gte":"1362787200000"}}}
			]}
		]}, "terms":{ "size":200000, "script_field":"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n" } }, "52":{ "facet_filter":{"and":[
			{"and":[
				{"range":{"modified_ts":{"lt":"1362700800000"}}},...Firebug request size limit has been reached by Firebug....ll
		)
		null;
		else
		hash[key];\n
	};
	\
	nvar
	getDocValue = function(name){\nvar
		out = [];\nvar
		v = doc[name];\nif(v == null || v.value == null)
		{
			null;
		}
		else
		if (v.values.length <= 1){
			v.value;
		} else{
			for(k :
			v.values
		)
			out.add(k);
			out;
		}
	};
	\
	nvar
	_1000 = function(bugs){\nvar
		bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n"
	}
	},
	"4"
	:
	{
		"facet_filter"
	:
		{
			"and"
		:
			[
				{"and":[
					{"range":{"modified_ts":{"lt":"1358553600000"}}},
					{"range":{"expires_on":{"gte":"1358553600000"}}}
				]}
			]
		}
	,
		"terms"
	:
		{
			"size"
		:
			200000, "script_field"
		:
			"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n"
		}
	}
	,
	"3"
	:
	{
		"facet_filter"
	:
		{
			"and"
		:
			[
				{"and":[
					{"range":{"modified_ts":{"lt":"1358467200000"}}},
					{"range":{"expires_on":{"gte":"1358467200000"}}}
				]}
			]
		}
	,
		"terms"
	:
		{
			"size"
		:
			200000, "script_field"
		:
			"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n"
		}
	}
	,
	"2"
	:
	{
		"facet_filter"
	:
		{
			"and"
		:
			[
				{"and":[
					{"range":{"modified_ts":{"lt":"1358380800000"}}},
					{"range":{"expires_on":{"gte":"1358380800000"}}}
				]}
			]
		}
	,
		"terms"
	:
		{
			"size"
		:
			200000, "script_field"
		:
			"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n"
		}
	}
	,
	"1"
	:
	{
		"facet_filter"
	:
		{
			"and"
		:
			[
				{"and":[
					{"range":{"modified_ts":{"lt":"1358294400000"}}},
					{"range":{"expires_on":{"gte":"1358294400000"}}}
				]}
			]
		}
	,
		"terms"
	:
		{
			"size"
		:
			200000, "script_field"
		:
			"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n"
		}
	}
	,
	"0"
	:
	{
		"facet_filter"
	:
		{
			"and"
		:
			[
				{"and":[
					{"range":{"modified_ts":{"lt":"1358208000000"}}},
					{"range":{"expires_on":{"gte":"1358208000000"}}}
				]}
			]
		}
	,
		"terms"
	:
		{
			"size"
		:
			200000, "script_field"
		:
			"var get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar bug_status = getDocValue(\"bug_status\");\noutput = (bug_status==\"resolved\" || bug_status==\"verified\" || bug_status==\"closed\") ? \"closed\" : \"open\"; output;\n};\n_1000(_source)\n"
		}
	}
	},
	"sort"
	:
	[], "size"
	:
	0, "from"
	:
	0, "query"
	:
	{
		"filtered"
	:
		{
			"filter"
		:
			{
				"and"
			:
				[
					{"script":{"script":"true"}},
					{"and":[
						{"and":[
							{"range":{"modified_ts":{"lt":1363392000000}}},
							{"range":{"expires_on":{"gte":1358208000000}}}
						]},
						{"script":{"script":"var floorInterval = function(value, interval){ Math.floor((double)value/(double)interval)*interval;};\nvar get = function(hash, key){\nif (hash==null) null; else hash[key];\n};\nvar getDocValue = function(name){\nvar out = [];\nvar v = doc[name];\nif (v==null || v.value==null) { null; } else if (v.values.length<=1){ v.value; } else {for(k : v.values) out.add(k); out;}};\nvar _1000 = function(bugs){\nvar modified_ts = getDocValue(\"modified_ts\");\nvar expires_on = getDocValue(\"expires_on\");\noutput = floorInterval(modified_ts-1358208000000, 86400000)!=floorInterval(expires_on-1358208000000, 86400000); output;\n};\n_1000(_source)\n"}},
						{"and":[
							{"script":{"script":"true"}},
							{"script":{"script":"true"}},
							{"script":{"script":"true"}}
						]}
					]}
				]
			}
		,
			"query"
		:
			{
				"match_all"
			:
				{
				}
			}
		}
	}
	}
	;
//		{
//			"facets":{"mvel":{"terms":{ "size":200000, "script_field":"doc[\"dependson\"].value"}}},
//			"sort":[], "size":0, "from":0, "query":{"filtered":{ "filter":{"and":[
////			{"term":{"bug_id":180171}}  //BAD
////			{"term":{"bug_id":6625}}	//GOOD
//		]}, "query":{"match_all":{}} }} };


		try{
			var data = yield(Rest.post({
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/bug_version/_mapping?pretty=true",
			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bugs/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_summary/bug_summary/_search",

//			"url":"http://localhost:9200/reviews/review/_search",
//			"url":"http://localhost:9200/bug_tags/bug_tags/_search",
//			"url":"http://elasticsearch8.metrics.scl3.mozilla.com:9200/reviews/review/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/bug_tags/bug_tags/_search",
//				"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/telemetry/_search",
//			"url":"http://elasticsearch7.metrics.scl3.mozilla.com:9200/org_chart/person/_search",
				"data":esQuery
			}));





			D.println(CNV.Object2JSON(data));

			var htmlSummary = CNV.ESResult2HTMLSummaries(data);
			var htmlResults = CNV.List2HTMLTable(CNV.ESResult2List(data));
			$("#info").html(htmlSummary + "<br><br>" + htmlResults);


//		while(true){
//			if (ETL.allFlags!==undefined) break;
//			yield (aThread.sleep(200));
//		}//while
//		var reviews=yield (REVIEWS.get(674239, 674240));
//		$("#info").append(CNV.List2HTMLTable(reviews));
//


		} catch(e){
			D.warning("Error sending requests", e);
			document.getElementById("info").innerHTML = "Response Error.  Make sure you are connected to the MPT network.";
		}

	});

</script>

</BODY>
</HTML>