<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HTML>
<HEAD>
</HEAD>
<BODY>
<!--&lt;!&ndash;[if lt IE 9]>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/excanvas.js"></script>-->
<!--<![endif]&ndash;&gt;-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/jquery.min.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/jquery.jqplot.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.barRenderer.min.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.categoryAxisRenderer.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.pointLabels.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.canvasAxisTickRenderer.js"></script>-->
<!--<script type="application/javascript;version=1.7" src="lib/jqplot/plugins/jqplot.logAxisRenderer.js"></script>-->
<!--<link rel="stylesheet" type="text/css" href="lib/jqplot/jquery.jqplot.css"/>-->






<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/Base.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/jquery.js"></script>
<script type="application/javascript;version=1.7" src="lib/jstree/jquery.jstree.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/jquery.tooltip.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/data/q01-01.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/protovis-d3.3.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/jquery.tipsy.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/tipsy.js"></script>
<link type="text/css" href="lib/webdetails/lib/tipsy.css" rel="stylesheet"/>

<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvc.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcPanel.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcLegend.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcTimeseriesAbstract.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcCategoricalAbstract.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcWaterfall.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcPie.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcBar.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcLine.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcData.js"></script>

<link type="text/css" rel="stylesheet" href="lib/webdetails/cdf/jquery.tooltip.css"/>
<link type="text/css" rel="stylesheet" href="lib/webdetails/pvcComponent.css"/>

<script type="application/javascript;version=1.7" src="lib/webdetails/pvcDocUtils.js"></script>








<link type="text/css" href="css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="css/menu.css"/>



<script type="application/javascript;version=1.7" src="js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="js/Bugzilla.js"></script>
<script type="application/javascript;version=1.7" src="js/util.js"></script>
<script type="application/javascript;version=1.7" src="js/Stats.js"></script>
<script type="application/javascript;version=1.7" src="js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="js/MVEL.js"></script>
<script type="application/javascript;version=1.7" src="js/aCompiler.js"></script>

<script type="application/javascript;version=1.7" src="js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/aChart.js"></script>






<script type="application/javascript;version=1.7" src="js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="js/rest/ElasticSearch.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/Status.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/DataSet.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/RangeCharts.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/RangeIterator.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/DateRangeIterator.js"></script>

<script type="application/javascript;version=1.7" src="js/filters/Filter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ComponentFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/TeamFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ProductFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ClassificationFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ProgramFilter.js"></script>

<script type="application/javascript;version=1.7" src="js/filters/GUI.js"></script>



<div id="sidebar">
	<div style="height: 30px; text-align: center;vertical-align:middle;">
		<span id="status" style="height:30px">Chart Loading...</span><span class="loading"><img src="images/spinner.gif" alt=""></span>
	</div>

	<hr>
	<div id="description"></div>
	<hr>
	<div id="testMessage"></div>
	<hr>
	<div id="stats"></div>
	<hr>
	<div id="parameters" class="parameters">
	</div>
	<div id="filters" class="menu"></div>
</div>

<div style="float:right;display: inline;">
	<a href="http://people.mozilla.com/~klahnakoski/" class="button">HOME</a>
</div>
<h3 id="title"></h3>
<div id="chart"></div>

<div id="info"></div>
<div id="report"></div>


<script type="application/javascript;version=1.7">


var CUTOFF=Duration.newInstance("3week");
$("#description").html("This chart includes all bugs <i>identified</i> between the Start and End Dates.  For closed bugs, the duration is defined from the time the bug is identified, to the time the bug is closed.  For open bugs, the duration is defined from the time the bug is identified, to the end of today (GMT).  These durations are partitioned into intervals, counted, and charted here.");

var thread;
var createChart=function(){
	if (thread!==undefined)
		thread.kill();
	thread=aThread.run( __createChart());
};

var __createChart = function(){

	var sampleMin=new Date(GUI.state.sampleMin);
	var sampleMax=new Date(GUI.state.sampleMax).ceilingDay();

	var sampleSize=sampleMax.subtract(sampleMin, Duration.newInstance(GUI.state.intervalX));
	$("#title").html("Time to Resolution ("+sampleSize.toString()+" sample)");

	var idTime=ProgramFilter.bugStatusMinimum_fromDoc();
	var closeTime="minimum("+sampleMax.getMilli()+", coalesce(zero2null(doc[\"close_time\"].value), "+sampleMax.getMilli()+"))";

	status.message("Download Times");
	var durations=yield(ESQuery.run({
		"from":"bug_summary",
		"select":
			{"name":"count", "value":"bug_id", "operation":"count"}
		,
		"edges":[
			{"name":"bug_status", "value":closeTime+" < "+sampleMax.getMilli()+" ? \"Closed\" : \"Open\""},
			{"name":"duration", "value":closeTime+"-"+idTime, "domain":{"type":"duration", "min":"0", "max":GUI.state.maxX, "interval":GUI.state.intervalX}}
		],
		"esfilter":{"and":[
			{"script":{"script":sampleMin.getMilli()+" <= "+idTime+" && "+idTime +" < "+sampleMax.getMilli()}},
			ProductFilter.makeFilter(),
			ComponentFilter.makeFilter()
		]}
	}));

	var average=yield(ESQuery.run({
		"from":"bug_summary",
		"select":[
			{"name":"duration", "value":closeTime+"-"+idTime, "operation":"average"}
		],
		"esfilter":{"and":[
			{"script":{"script":sampleMin.getMilli()+" <= "+idTime+" && "+idTime +" < "+sampleMax.getMilli()}},
			ProductFilter.makeFilter(),
			ComponentFilter.makeFilter()
		]}
	}));


	var stats = (yield(CUBE.calc2Cube({
		"from": (yield (CUBE.Cube2List(durations))),
		"select":[
			{"name":"total", "value":"count", "operation":"sum"},
			{"name":"num_open", "value":"bug_status=='Open' ? count : 0", "operation":"sum"},
			{"name":"num_closed", "value":"bug_status=='Closed' ? count : 0", "operation":"sum"},
			{"name":"under", "value":"duration.value.milli<"+CUTOFF.milli+" ? count : 0", "operation":"sum"}
		]
	}))).cube;


	$("#stats").html(
		'<span class="parameter_name">Total Bugs:</span><b>'+stats.total+'</b><br>'+
		'<span class="parameter_name">Bugs Closed per week:</span><b>'+Math.round(stats.num_closed/(sampleSize.milli/Duration.MILLI_VALUES.week), 0)+'</b><br>'+
		'<span class="parameter_name">Open Bugs Remaining:</span><b>'+Math.round(stats.num_open, 0)+'</b><br>'+
		'<span class="parameter_name">% Under '+CUTOFF.toString()+'</span><b>'+Math.round(stats.under/stats.total*100, 1)+'%</b><br>'+
		'<span class="parameter_name">Average Time Open:</span><b>'+Math.round(average.cube.duration/Duration.MILLI_VALUES.day, 2)+'days</b><br>'
	);

	durations.edges[1].domain.NULL.name="Over "+GUI.state.maxX;

	status.message("Make chart");
	aChart.show({
		"id":"chart",
		"type":"bar",
		"stacked":true,
		"cube":durations
	});
	status.message("Done");


};





	$(document).ready(function(){
		GUI.setup([
			{"id":"minX", "name":"Min X-axis on Chart", "type":"duration", "default":Duration.newInstance("0")},
			{"id":"maxX", "name":"Max X-axis on Chart", "type":"duration", "default":Duration.newInstance("3month")},
			{"id":"intervalX", "name":"X-axis Interval", "type":"duration", "default":Duration.newInstance("week")},
			{"id":"sampleMin", "name":"Start Date", "type":"time", "default":Date.eod().add("-18week")},
			{"id":"sampleMax", "name":"End Date", "type":"time", "default":Date.today()}
		],
		[
			"maxX=Duration.newInstance(maxX).add(Duration.newInstance(intervalX)).add(Duration.newInstance('-second')).floor(Duration.newInstance(intervalX)).toString()"
		],
		"bug_summary");
	});

</script>


</BODY>
</HTML>

