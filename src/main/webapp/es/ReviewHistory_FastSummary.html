
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HTML>

<HEAD>
</HEAD>
<BODY>

<!--[if lt IE 9]>

<![endif]-->









<link rel="stylesheet" type="text/css" href="lib/jqplot/jquery.jqplot.css"/>






<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/Base.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/jquery.js"></script>
<script type="application/javascript;version=1.7" src="lib/jstree/jquery.jstree.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/jquery.tooltip.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/data/q01-01.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/protovis-d3.3.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/jquery.tipsy.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/tipsy.js"></script>
<link type="text/css" href="lib/webdetails/lib/tipsy.css" rel="stylesheet"/>

<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvc.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcPanel.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcLegend.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcTimeseriesAbstract.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcCategoricalAbstract.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcWaterfall.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcPie.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcBar.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcLine.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcData.js"></script>
<link type="text/css" rel="stylesheet" href="lib/webdetails/cdf/jquery.tooltip.css"/>
<link type="text/css" rel="stylesheet" href="lib/webdetails/pvcComponent.css"/>

<script type="application/javascript;version=1.7" src="lib/webdetails/pvcDocUtils.js"></script>

<link type="text/css" href="css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="css/menu.css"/>




<script type="application/javascript;version=1.7" src="js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="js/Bugzilla.js"></script>
<script type="application/javascript;version=1.7" src="js/util.js"></script>
<script type="application/javascript;version=1.7" src="js/Stats.js"></script>
<script type="application/javascript;version=1.7" src="js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="js/aCompiler.js"></script>
<script type="application/javascript;version=1.7" src="js/MVEL.js"></script>

<script type="application/javascript;version=1.7" src="js/aThread.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.analytic.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="js/rest/Rest.js"></script>
<script type="application/javascript;version=1.7" src="js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/aChart.js"></script>


<script type="application/javascript;version=1.7" src="js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="js/rest/ElasticSearch.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/Status.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/DataSet.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/RangeCharts.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/RangeIterator.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/DateRangeIterator.js"></script>

<script type="application/javascript;version=1.7" src="js/filters/Filter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ComponentFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/TeamFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ProductFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ClassificationFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ProgramFilter.js"></script>

<script type="application/javascript;version=1.7" src="js/filters/GUI.js"></script>


<h3>Give me a name</h3>
<div id="sidebar">
	<div style="height: 30px; text-align: center;vertical-align:middle;">
		<span id="status" style="height:30px">Chart Loading...</span><span class="loading"><img src="images/spinner.gif" alt=""></span>
	</div>

	<hr>
	<div id="description"></div>
	<hr>
	<div id="testMessage"></div>
	<hr>
	<div id="parameters" class="parameters">
	</div>
	<div id="filters" class="menu"></div>
</div>

<div style="float:right;display: inline;">
	<a href="http://people.mozilla.com/~klahnakoski/" class="button">HOME</a>
</div>
<div id="chart"></div>

<div id="info"></div>
<div id="report"></div>

<script type="application/javascript;version=1.7">

	$("#description").html("Shows the number of reviews the reviewer was reviewing for each interval.  This can include new reviews, or reviews untouched since the previous interval.");

	var createChart=function(){

		var esQuery = new ESQuery({
			"from":"reviews",
			"select":[
				{"name":"num", "value":"bug_id", "operation":"count"}
			],
			"edges":[
				{"name":"duration", "value":"reviews.review_time-reviews.request_time",
					"domain":{"type":"duration", "min":"0", "max":"18week", "interval":"week"}
				}
			],
			"esfilter":{"and":[
				{"range":{"request_time":{"gte":Date.today().subtract(Duration.newInstance("18week"))}}}
			]}
		});

		console.info(CNV.Object2JSON(esQuery.esQuery));

		status.message("Call ES");


		esQuery.run(function(reviewQueues){
			status.message("Prep Chart");

D.println(CNV.List2Tab(reviewQueues));

			var chart=CUBE.calc2Cube({
				"name":
					"Historical Review Queue for "+GUI.state.requestee,
				"from":reviewQueues.list,
				"select":{"name":"Pending", "value":"1", operation:"sum"},
				"edges":[
					{"name":"Bug ID", "value":"bug_id", "sort":["request_time", "review_time"]},
					{"name":"Date",
						"test":"request_time<=time.value && time.value<=review_time",
						"domain":{"type":"time", "min":sampleMin, "max":sampleMax, "interval":sampleInterval, "format":"NNN dd"}
					}
				]
			});

			aChart.show({
				"id":"chart",
				"type":"stacked",
				"cube":chart
			});

			status.message("Done");

		});
	};//createChart


	$(document).ready(function(){
		GUI.setup([
			{"id":"requestee", "name":"Reviewer Email", "type":"text", "default":"nobody@mozilla.com"},
			{"id":"sampleMin", "name":"Sample From", "type":"time", "default":Date.today().add("-14day")},
			{"id":"sampleMax", "name":"Sample To", "type":"time", "default":Date.today()},
			{"id":"sampleInterval", "name":"Interval", "type":"duration", "default":Duration.newInstance("day")},
			{"id":"esSize", "name":"ES sample limit", "type":"integer", "default":100000}
		],
		[
			"sampleMax=GUI.fixEndDate(new Date(sampleMin), new Date(sampleMax), Duration.newInstance(sampleInterval)).format('yyyy-MM-dd')"
		]);
	});

//	createChart();

</script>


</BODY>
</HTML>