<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<HTML>
<HEAD>
</HEAD>
<BODY>



<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/Base.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/jquery.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/cdf/jquery.tooltip.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/data/q01-01.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/protovis-d3.3.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/jquery.tipsy.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/lib/tipsy.js"></script>
<link type="text/css" href="lib/webdetails/lib/tipsy.css" rel="stylesheet"/>

<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvc.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcPanel.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcLegend.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcTimeseriesAbstract.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcCategoricalAbstract.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcWaterfall.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcPie.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcBar.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcLine.js"></script>
<script type="application/javascript;version=1.7" src="lib/webdetails/pvc/pvcData.js"></script>
<link type="text/css" rel="stylesheet" href="lib/webdetails/cdf/jquery.tooltip.css"/>
<link type="text/css" rel="stylesheet" href="lib/webdetails/pvcComponent.css"/>

<script type="application/javascript;version=1.7" src="lib/webdetails/pvcDocUtils.js"></script>

<link type="text/css" href="css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet"/>
<script type="application/javascript;version=1.7" src="lib/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="application/javascript;version=1.7" src="lib/js/jquery.ba-bbq.js"></script>

<link type="text/css" rel="stylesheet" href="css/menu.css"/>




<script type="application/javascript;version=1.7" src="js/CNV.js"></script>
<script type="application/javascript;version=1.7" src="js/aDate.js"></script>

<script type="application/javascript;version=1.7" src="js/MozillaPrograms.js"></script>
<script type="application/javascript;version=1.7" src="js/util.js"></script>
<script type="application/javascript;version=1.7" src="js/Debug.js"></script>
<script type="application/javascript;version=1.7" src="js/aCompiler.js"></script>
<script type="application/javascript;version=1.7" src="js/MVEL.js"></script>

<script type="application/javascript;version=1.7" src="js/Trampoline.js"></script><script type="application/javascript;version=1.7" src="js/CUBE.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.aggregate.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.column.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.cube.js"></script>
<script type="application/javascript;version=1.7" src="js/CUBE.domain.js"></script>
<script type="application/javascript;version=1.7" src="js/ESQuery.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/aChart.js"></script>


<script type="application/javascript;version=1.7" src="js/charts/HelperFunctions.js"></script>
<script type="application/javascript;version=1.7" src="js/rest/ElasticSearchQuery.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/Status.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/DataSet.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/RangeCharts.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/RangeIterator.js"></script>
<script type="application/javascript;version=1.7" src="js/charts/DateRangeIterator.js"></script>

<script type="application/javascript;version=1.7" src="js/filters/Filter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ComponentFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ProductFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/ProgramFilter.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/CustomFilters.js"></script>
<script type="application/javascript;version=1.7" src="js/filters/GUIFilters.js"></script>

<div id="sidebar">
	<div style="height: 30px; text-align: center;vertical-align:middle;">
		<span id="status" style="height:30px">Chart Loading...</span><span class="loading"><img src="images/spinner.gif" alt=""></span>
	</div>

	<hr>
	<div id="description"></div>
	<hr>
	<div id="testMessage"></div>
	<hr>
	<div id="singleNumber"></div>
	<hr>
	<div id="parameters" class="parameters">
	</div>
	<div id="filters" class="menu"></div>
</div>

<div style="float:right;display: inline;">
	<a href="http://people.mozilla.com/~klahnakoski/" class="button">HOME</a>
</div>
<div id="chart"></div>

<div id="oldReviews"></div>

<script type="application/javascript;version=1.7">

	$("#description").html("Metrics for all reviews requested in the past 18weeks.");

	var q=new ESQuery({
		"from":"reviews",
		"select":[
			{"name":"reviewer", value:"reviews.requester"},
			{"name":"request_time", value:"new Date(reviews.request_time)"},
			{"name":"bug_id", "value":"reviews.bug_id"}
		],
		"esfilter":{
			"and":[
				{"range":{"request_time":{"lt":Date.now().floorDay().add("-18week").getMilli()}}},
				{"missing":{"field":"review_time"}}
			]
		}
	});

	q.run(function(old){
		var oldRequests=new CUBE().calc2List({
			"from":old.list,
			"select":[
				{"name":"avg_request_time", "value":"request_time", "operation":"average"},
				{"name":"count", "value":"bug_id", "operation":"count", "sort":"decending"},
				{"name":"bugs", "value":"bug_id", "operation":"join", "separator":","}
			],
			"edges":[
				{"value":"reviewer"}
			],
			"order":[
				"count"
			]
		}).list;

		//ADD LINK TO BUGS
		var show=new CUBE().calc2List({
			"from":oldRequests,
			"select":[
				{"name":"reviewer", value:"reviewer"},
				{"name":"avg_request_time", value:"avg_request_time"},
				{"name":"count", value:"count"},
				{"name":"bugs", "value":"\"<a href='https://bugzilla.mozilla.org/buglist.cgi?quicksearch=\"+(''+bugs).replaceAll(', ', '%2C')+\"'>\"+bugs+\"</a>\""}
			]
		}).list;

		$("#oldReviews").html(CNV.List2HTMLTable(show));



		////////////////////////////////////////////////////////////////////////
		//SHOW CHART OF REMAINING TIMES
		////////////////////////////////////////////////////////////////////////
		var q2=new ESQuery({
			"name":"Review Request Wait Times",
			"from":"reviews",
			"select":[
				{"name":"count", "value":"bug_id", "operation":"count"}
			],
			"edges":[
				{"name":"wait_duration", "value":"coalesce(reviews.review_time, "+Date.now().getMilli()+")-reviews.request_time",
					"domain":{"type":"duration", "min":0, "max":"10day", "interval":"6hour"}
				}
			],
			"esfilter":{
				"and":[
					{"range":{"request_time":{"gt":Date.now().floorDay().add(Duration.newInstance("-18week")).getMilli()}}}
				]
			}
		});

		q2.run(function(chart){
			aChart.showCCC({
				"id":"chart",
				"type":"stacked",
				"cube":chart
			});
		});

	});

</script>

</BODY>
</HTML>